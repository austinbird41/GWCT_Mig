USE [D365Migration]
GO
/****** Object:  StoredProcedure [dbo].[DataLake_ReleasedProducts_GPToD365DB]    Script Date: 5/18/2022 3:04:20 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
ALTER Procedure [dbo].[DataLake_ReleasedProducts_GPToD365DB]
as
INSERT INTO [dbo].[DATALAKE_RELEASEDPRODUCTS]
           ([DataAreaId]
           ,[ItemNumber]
           ,[ProductNumber]
           ,[StorageDimensionGroupName]
           ,[TrackingDimensionGroupName]
           ,[ItemModelGroupId],
		   searchname
           ,[ProductType]
           ,[PurchaseUnitSymbol]
           ,[SalesUnitSymbol]
           ,[InventoryUnitSymbol]
           ,[ProductGroupId]
           ,[ProductSubType]
           ,[PrimaryVendorAccountNumber]
           ,[PurchasePrice])
--Released Products
  SELECT 'GICT' as DataAreaId, 
  I.ITEMNMBR AS ITEMNUMBER, 
  i.ITEMNMBR as productNumber,
		--I.ITEMNMBR, --as ProductNumber,
		'SiteWH'      AS  STORAGEDIMENSIONGROUPNAME,
		'None'		AS TRACKINGDIMENSIONGROUPNAME,
		'INV' as ITEMMODELGROUPID,	
      I.itemdesc                                   AS SEARCHNAME,
	  --I.ITEMDESC									as ProductSearchName,
	  'Item'		as ProductType,
	  'Ea' AS        PURCHASEUNITSYMBOL, 
	  'Ea' AS SALESUNITSYMBOL, 
	  'Ea' as inventoryunitsymbol,
	  Case
		when I.USCATVLS_1 in ('Men''s', 'Children''s', 'unisex', 'WOMEN''S')
			then '010'
		when I.USCATVLS_1 in ('Electonics')
			then '020'
		when I.USCATVLS_1 in ('LAWN&GARDN ', 'MATTRESSES', 'Household','HOME DÃ‰COR')
			then '030'
		when I.USCATVLS_1 in ('SEASONAL', 'ARTS CRAFT', 'MISC', 'TOY')
			then '050'
		when I.USCATVLS_1 in ('PET SUPPLY')
			then '060'
		ELSE '050'
	end as productgroupid,
		'Product' AS PRODUCTSUBTYPE, --Product
		case
			when ITMGEDSC = '#N/A'
			then ''
			else ITMGEDSC
		end as PRIMARYVENDORACCOUNTNUMBER,
		CURRCOST as PURCHASEPRICE

FROM gwc.dbo.[IV00101] I
left join gwc.dbo.GL00105 gl5
on gl5.ACTINDX = i.IVIVINDX
WHERE (I.ITEMTYPE = 1
AND I.ITMCLSCD != 'Delete'
and i.ITEMNMBR in (select p.item from POSDatabase.[SiriusSQL].[dbo].[items] p))
or (i.USCATVLS_1 like 'supplies%' or i.USCATVLS_1 like 'uniform%')