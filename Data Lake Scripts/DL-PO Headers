USE [D365Migration]
GO
/****** Object:  StoredProcedure [dbo].[DataLake_PurchaseOrderHeaders_GPToD365DB]    Script Date: 4/27/2022 9:33:34 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
ALTER PROCEDURE [dbo].[DataLake_PurchaseOrderHeaders_GPToD365DB]
AS


INSERT INTO [dbo].[DATALAKE_PurchaseOrderHeaders]
           ([DataAreaId]
           ,[PurchaseOrderNumber]
           ,[ORDERVENDORACCOUNTNUMBER]
           ,[PurchaseOrderName]
           ,[DeliveryAddressCountryRegionId]
           ,[DELIVERYADDRESSSTREET]
           ,[DELIVERYADDRESSCITY]
           ,[DELIVERYADDRESSSTATEID]
           ,[DELIVERYADDRESSZIPCODE]
           ,[DELIVERYADDRESSCOUNTRYREGIONISOCODE]
           ,[PaymentTermsName]
           ,[currencycode]
           ,[iNVOICEADDRESSSTREET]
           ,[INVOICEADDRESSCITY]
           ,[INVOICEADDRESSSTATE]
           ,[INVOICEADDRESSZIPCODE]
           ,[REQUESTEDDELIVERYDATE]
           ,[CONFIRMEDDELIVERYDATE]
           ,[FixedDueDate])
select 
'GICT' as dataareaid,
p.PONUMBEr as PurchaseOrderNumber,
--p.POSTATUS as PurchaseOrderStatus,
--p.POTYPE, --could map to delivery terms or mode 1=standard, 2= dropship, 3=blanket, 4=blanket drop ship
--p.TXRGNNUM,
p.vendorid AS ORDERVENDORACCOUNTNUMBER,
p.VENDNAME as PurchaseOrderName
--p.VADCDPAD --vendor address code
--,CMPANYID --not sure what this would be used for
--,contact
,concat(trim(address1),' ', trim(address2),' ', trim(address3)) AS DELIVERYADDRESSSTREET
,city DELIVERYADDRESSCITY
,state as DELIVERYADDRESSSTATEID
,ZIPCODE as DELIVERYADDRESSZIPCODE
,CCode as DELIVERYADDRESSCOUNTRYREGIONISOCODE
,country as DELIVERYADDRESSCOUNTRYREGIONID
,PYMTRMID as PaymentTermsName
,'USD' as currencycode
--BUYERID --??
--TXSCHSRC 
--,Purchase_Freight_Taxable
--,Purchase_Misc_Taxable
,concat(trim(purchaddress1), ' ', trim(purchaddress2),' ', trim(purchaddress3)) AS iNVOICEADDRESSSTREET

,PURCHCITY as INVOICEADDRESSCITY
,PURCHSTATE AS INVOICEADDRESSSTATE
,PURCHZIPCODE AS INVOICEADDRESSZIPCODE
--DATES
,p.PRMDATE as REQUESTEDDELIVERYDATE,
p.PRMSHPDTE  as CONFIRMEDDELIVERYDATE,
p.REQDATE AS FixedDueDate
--DUEDATE as FixedDueDate,
--AMOUNTS (only stored at line level in D365)
--p.REMSUBTO
--,OREMSUBT --Originating Remaining Subtotal
--,ORSUBTOT --originating subtotal

--Remaining Questions
--do we need any of the workflow fields? 
--do we need purhcase order notes?

from gwc.dbo.POP30100 p
where p.VENDORID != '' and p.REQDATE >= '2017-01-01'


union

select 
'GTS' as dataareaid,
p.PONUMBER as PurchaseOrderNumber,
--p.POSTATUS as PurchaseOrderStatus,
--p.POTYPE, --could map to delivery terms or mode 1=standard, 2= dropship, 3=blanket, 4=blanket drop ship
--p.TXRGNNUM,
p.vendorid AS ORDERVENDORACCOUNTNUMBER,
p.VENDNAME as PurchaseOrderName
--p.VADCDPAD --vendor address code
--,CMPANYID --not sure what this would be used for
--,contact
,concat(trim(address1),' ', trim(address2),' ', trim(address3)) AS DELIVERYADDRESSSTREET
,city DELIVERYADDRESSCITY
,state as DELIVERYADDRESSSTATEID
,ZIPCODE as DELIVERYADDRESSZIPCODE
,CCode as DELIVERYADDRESSCOUNTRYREGIONISOCODE
,country as DELIVERYADDRESSCOUNTRYREGIONID
,PYMTRMID as PaymentTermsName
,'USD' as currencycode
--BUYERID --??
--TXSCHSRC 
--,Purchase_Freight_Taxable
--,Purchase_Misc_Taxable
,concat(trim(purchaddress1), ' ', trim(purchaddress2),' ', trim(purchaddress3)) AS iNVOICEADDRESSSTREET
,PURCHCITY as INVOICEADDRESSCITY
,PURCHSTATE AS INVOICEADDRESSSTATE
,PURCHZIPCODE AS INVOICEADDRESSZIPCODE
--DATES
,p.PRMDATE as REQUESTEDDELIVERYDATE,
p.PRMSHPDTE  as CONFIRMEDDELIVERYDATE,
p.REQDATE AS FixedDueDate
--DUEDATE as FixedDueDate,
--AMOUNTS (only stored at line level in D365)
--p.REMSUBTO
--,OREMSUBT --Originating Remaining Subtotal
--,ORSUBTOT --originating subtotal

--Remaining Questions
--do we need any of the workflow fields? 
--do we need purhcase order notes?

from GSS.dbo.POP30100 p
where p.VENDORID != '' and p.REQDATE >= '2017-01-01'

union

select
'BLUE' as dataareaid,
p.PONUMBER as PurchaseOrderNumber,
--p.POSTATUS as PurchaseOrderStatus,
--p.POTYPE, --could map to delivery terms or mode 1=standard, 2= dropship, 3=blanket, 4=blanket drop ship
--p.TXRGNNUM,
p.vendorid AS ORDERVENDORACCOUNTNUMBER,
p.VENDNAME as PurchaseOrderName
--p.VADCDPAD --vendor address code
--,CMPANYID --not sure what this would be used for
--,contact
,concat(trim(address1),' ', trim(address2),' ', trim(address3)) AS DELIVERYADDRESSSTREET
,city DELIVERYADDRESSCITY
,state as DELIVERYADDRESSSTATEID
,ZIPCODE as DELIVERYADDRESSZIPCODE
,CCode as DELIVERYADDRESSCOUNTRYREGIONISOCODE
,country as DELIVERYADDRESSCOUNTRYREGIONID
,PYMTRMID as PaymentTermsName
,'USD' as currencycode
--BUYERID --??
--TXSCHSRC 
--,Purchase_Freight_Taxable
--,Purchase_Misc_Taxable
,concat(trim(purchaddress1), ' ', trim(purchaddress2),' ', trim(purchaddress3)) AS iNVOICEADDRESSSTREET
,PURCHCITY as INVOICEADDRESSCITY
,PURCHSTATE AS INVOICEADDRESSSTATE
,PURCHZIPCODE AS INVOICEADDRESSZIPCODE
--DATES
,p.PRMDATE as REQUESTEDDELIVERYDATE,
p.PRMSHPDTE  as CONFIRMEDDELIVERYDATE,
p.REQDATE AS FixedDueDate
--DUEDATE as FixedDueDate,
--AMOUNTS (only stored at line level in D365)
--p.REMSUBTO
--,OREMSUBT --Originating Remaining Subtotal
--,ORSUBTOT --originating subtotal

--Remaining Questions
--do we need any of the workflow fields? 
--do we need purhcase order notes?

from blue.dbo.POP30100 p
where p.VENDORID != '' and p.REQDATE >= '2017-01-01'

union

select
'Excl' as dataareaid,
p.PONUMBER as PurchaseOrderNumber,
--p.POSTATUS as PurchaseOrderStatus,
--p.POTYPE, --could map to delivery terms or mode 1=standard, 2= dropship, 3=blanket, 4=blanket drop ship
--p.TXRGNNUM,
p.vendorid AS ORDERVENDORACCOUNTNUMBER,
p.VENDNAME as PurchaseOrderName
--p.VADCDPAD --vendor address code
--,CMPANYID --not sure what this would be used for
--,contact
,concat(trim(address1),' ', trim(address2),' ', trim(address3)) AS DELIVERYADDRESSSTREET
,city DELIVERYADDRESSCITY
,state as DELIVERYADDRESSSTATEID
,ZIPCODE as DELIVERYADDRESSZIPCODE
,CCode as DELIVERYADDRESSCOUNTRYREGIONISOCODE
,country as DELIVERYADDRESSCOUNTRYREGIONID
,PYMTRMID as PaymentTermsName
,'USD' as currencycode
--BUYERID --??
--TXSCHSRC 
--,Purchase_Freight_Taxable
--,Purchase_Misc_Taxable
,concat(trim(purchaddress1), ' ', trim(purchaddress2),' ', trim(purchaddress3)) AS iNVOICEADDRESSSTREET
,PURCHCITY as INVOICEADDRESSCITY
,PURCHSTATE AS INVOICEADDRESSSTATE
,PURCHZIPCODE AS INVOICEADDRESSZIPCODE
--DATES
,p.PRMDATE as REQUESTEDDELIVERYDATE,
p.PRMSHPDTE  as CONFIRMEDDELIVERYDATE,
p.REQDATE AS FixedDueDate
--DUEDATE as FixedDueDate,
--AMOUNTS (only stored at line level in D365)
--p.REMSUBTO
--,OREMSUBT --Originating Remaining Subtotal
--,ORSUBTOT --originating subtotal

--Remaining Questions
--do we need any of the workflow fields? 
--do we need purhcase order notes?

from excel.dbo.pop10100 p
where p.VENDORID != '' and p.REQDATE >= '2017-01-01' and p.REQDATE >= '2017-01-01'














