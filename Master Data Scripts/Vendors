USE [D365Migration]
GO
/****** Object:  StoredProcedure [dbo].[Vendors_GPToD365DB]    Script Date: 7/5/2022 4:18:20 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO


ALTER PROCEDURE [dbo].[Vendors_GPToD365DB]
as
INSERT INTO [dbo].[Vendors]
           ([DataAreaId],
		   VendorPartyNumber
           ,[vendoraccountnumber]
           ,[vendorsearchname]
           ,[vendororganizationname]
           --,[AddressStreet]
           --,[addresscity]
           --,[addressstateid]
           --,[addresscountryregionid]
           --,[ADDRESSCOUNTRYREGIONISOCODE]
           --,[addresszipcode]
           --,[PrimaryPhoneNumber]
           --,[PrimaryFaxNumber]
           ,[VendorGroupID]
           ,[CurrencyCode]
           ,[DEFAULTPAYMENTTERMSNAME]
		   ,DEFAULTVENDORPAYMENTMETHODNAME
           ,[OnHoldStatus]
           ,[TAX1099IDTYPE]
           ,[IsReportingTax1099]
		   ,IsW9Received
           ,[CreditRating]
		    ,[DEFAULTPROCUMENTWAREHOUSEID]
		    ,[DEFAULTPURCHASESITEID]
			,[VENDORINVOICELINEMATCHINGPOLICY]
           ,[TAX1099DOINGBUSINESSASNAME]
           ,TAX1099NAMETOUSE
		   ,TAX1099FEDERALTAXID
		   ,bankaccountId
		   ,[OurAccountNumber],
		   DEFAULTLEDGERDIMENSIONDISPLAYVALUE,
		   TAX1099BOXID
		   ,Tax1099Type
		   )

select 
'GICT' as DataAreaId,
Concat('Party-', 'GICT-',VENDORID) as VendorPartyNumber,
		case 
	when len(dense_rank() over (order by vt.vendorid)) = 1
		then '1000000' + Cast((dense_rank() over (order by vt.vendorid)) as Nvarchar(10))
	when len(dense_rank() over (order by vt.vendorid)) = 2
		then '100000' + Cast((dense_rank() over (order by vt.vendorid)) as Nvarchar(10))
	when len(dense_rank() over (order by vt.vendorid)) = 3
		then '10000' + Cast((dense_rank() over (order by vt.vendorid)) as Nvarchar(10))
	when len(dense_rank() over (order by vt.vendorid)) = 4
		then '1000' + Cast((dense_rank() over (order by vt.vendorid)) as Nvarchar(10))
	when len(dense_rank() over (order by vt.vendorid)) = 5
		then '100' + Cast((dense_rank() over (order by vt.vendorid)) as Nvarchar(10))
	when len(dense_rank() over (order by vt.vendorid)) = 6
		then '10' + Cast((dense_rank() over (order by vt.vendorid)) as Nvarchar(10))
	when len(dense_rank() over (order by vt.vendorid)) = 7
		then '' + Cast((dense_rank() over (order by vt.vendorid)) as Nvarchar(10))
	end as vendoraccountnumber,
vendname as vendorsearchname,
vendname as vendororganizationname,
	ISNULL((case 
		when trim(ACNMVNDR) = 'New goods'
			then '100'
		when trim(ACNMVNDR) = 'Rent'
			then '200'
		when trim(ACNMVNDR) = 'Standard'
			then '300'
		when trim(ACNMVNDR) = 'Utility'
			then '400'
		when trim(ACNMVNDR) = 'Priority'
			then '500'
		when trim(ACNMVNDR) = 'Carrier'
			then '600'
		when trim(ACNMVNDR) = 'Software'
			then '700'
		when trim(ACNMVNDR) = 'Client Assist'
			then '800'
		when trim(ACNMVNDR) = 'CONTRACTOR'
			then '825'
		when trim(ACNMVNDR) = 'GCTA Instructor'
			then '850'
		when trim(ACNMVNDR) = 'Garnishments'
			then 900
		else '300'
	end),'') as VendorGroupID,
'USD' as CurrencyCode,
--PYMTRMID as DEFAULTPAYMENTTERMSNAME,
--case
--	when vt.COMMENT2 like 'du%'
--		then 'Due Upon Receipt'
--	when vt.comment2 like 'net%'
--		then 'Net 15'
--	else vt.COMMENT2
--end as DEFAULTPAYMENTTERMSNAME,
vt.comment2,
case when
	vt.COMMENT1 like 'manual%'
		then 'check'
	else vt.comment1
end as DEFAULTVENDORPAYMENTMETHODNAME,
hold as OnHoldStatus,
IsNULL(vt.ten99type,'') as TAX1099IDTYPE,
case
	when UserDef1 like '%1099%'
		then 'Yes'
	else 'No'
end as IsReportingTax1099,
'Yes' as IsW9Received,
CREDTLMT as CreditRating,
	case 
		when trim(ACNMVNDR) = 'New goods'
			then '100'
		else ''
	end as DEFAULTPROCUMENTWAREHOUSEID,
	case 
		when trim(ACNMVNDR) = 'New goods'
			then '10'
		else ''
	end as DEFAULTPURCHASESITEID,
	case 
		when trim(ACNMVNDR) = 'New goods'
			then 1
		else ''
	end as VENDORINVOICELINEMATCHINGPOLICY
,VNDCHKNM as TAX1099DOINGBUSINESSASNAME
,1 as TAX1099NAMETOUSE
,TXIDNMBR AS TAX1099FEDERALTAXID
,'' AS BANKACCOUNTID , vt.vendorId as YourAccountNumber
,case
	when ACNMVNDR = 'New goods'
		then '-160000-1-9999--Proj999999'
	else '--1-9999--Proj999999'
end as DEFAULTLEDGERDIMENSIONDISPLAYVALUE,
case
	when t.TEN99BOXTEXT = '1' then 'MISC-01'
	when t.TEN99BOXTEXT = '2' then 'MISC-02'
	when t.TEN99BOXTEXT = '3' then 'MISC-03'
	when t.TEN99BOXTEXT = '4' then 'MISC-04'
	when t.TEN99BOXTEXT = '5' then 'MISC-05'
	when t.TEN99BOXTEXT = '6' then 'MISC-06'
	when t.TEN99BOXTEXT = '7' then 'NEC-01'
	when t.TEN99BOXTEXT = '8' then 'MISC-08'
	when t.TEN99BOXTEXT = '10' then 'MISC-09'
	when t.TEN99BOXTEXT = '13' then 'MISC-13'
	when t.TEN99BOXTEXT = '14' then 'MISC-10'
	when t.TEN99BOXTEXT = '15a' then 'MISC-12'
	when t.TEN99BOXTEXT = '15b' then 'MISC-14'
	when t.TEN99BOXTEXT = '16' then 'MISC-15'
	when t.TEN99BOXTEXT = '18' then 'MISC-03'
else ''
end as TAX1099BOXID
,case 
	when t.TEN99BOXTEXT in ('1','2','3','4','5','6','8','10','13','14','15a','15b','16','18')
		then '1099-MISC'
	when t.TEN99BOXTEXT = '7'
		then '1099-NEC'
	else ''
end as  'Tax1099Type'
from gwc.dbo.PM00200 vt
left join gwc.[dbo].[PM40104] t
on t.TEN99BOXNUMBER = vt.TEN99BOXNUMBER
and t.TEN99TYPE = 3
where vt.vendstts = 1

union

select 
'BLUE' as DataAreaId,
Concat('Party-', 'BLUE-',VENDORID) as VendorPartyNumber,
		case 
	when len(dense_rank() over (order by vt.vendorid)) = 1
		then '1000000' + Cast((dense_rank() over (order by vt.vendorid)) as Nvarchar(10))
	when len(dense_rank() over (order by vt.vendorid)) = 2
		then '100000' + Cast((dense_rank() over (order by vt.vendorid)) as Nvarchar(10))
	when len(dense_rank() over (order by vt.vendorid)) = 3
		then '10000' + Cast((dense_rank() over (order by vt.vendorid)) as Nvarchar(10))
	when len(dense_rank() over (order by vt.vendorid)) = 4
		then '1000' + Cast((dense_rank() over (order by vt.vendorid)) as Nvarchar(10))
	when len(dense_rank() over (order by vt.vendorid)) = 5
		then '100' + Cast((dense_rank() over (order by vt.vendorid)) as Nvarchar(10))
	when len(dense_rank() over (order by vt.vendorid)) = 6
		then '10' + Cast((dense_rank() over (order by vt.vendorid)) as Nvarchar(10))
	when len(dense_rank() over (order by vt.vendorid)) = 7
		then '' + Cast((dense_rank() over (order by vt.vendorid)) as Nvarchar(10))
	end as vendoraccountnumber,
vendname as vendorsearchname,
vendname as vendororganizationname,
	ISNULL((case 
		when trim(ACNMVNDR) = 'New goods'
			then '100'
		when trim(ACNMVNDR) = 'Rent'
			then '200'
		when trim(ACNMVNDR) = 'Standard'
			then '300'
		when trim(ACNMVNDR) = 'Utility'
			then '400'
		when trim(ACNMVNDR) = 'Priority'
			then '500'
		when trim(ACNMVNDR) = 'Carrier'
			then '600'
		when trim(ACNMVNDR) = 'Software'
			then '700'
		when trim(ACNMVNDR) = 'Client Assist'
			then '800'
		when trim(ACNMVNDR) = 'CONTRACTOR'
			then '825'
		when trim(ACNMVNDR) = 'GCTA Instructor'
			then '850'
		when trim(ACNMVNDR) = 'Garnishments'
			then 900
		else '300'
	end),'') as VendorGroupID,

'USD' as CurrencyCode,
--PYMTRMID as DEFAULTPAYMENTTERMSNAME,
--case
--	when vt.COMMENT2 like 'du%'
--		then 'Due Upon Receipt'
--	when vt.comment2 like 'net%'
--		then 'Net 15'
--	else vt.COMMENT2
--end as DEFAULTPAYMENTTERMSNAME,
vt.comment2,
case when
	vt.COMMENT1 like 'manual%'
		then 'check'
	else vt.comment1
end as DEFAULTVENDORPAYMENTMETHODNAME,
hold as OnHoldStatus,
IsNULL(vt.ten99type,'') as TAX1099IDTYPE,
case
	when UserDef1 like '%1099%'
		then 'Yes'
	else 'No'
end as IsReportingTax1099,
'Yes' as IsW9Received,
CREDTLMT as CreditRating,
	case 
		when trim(ACNMVNDR) = 'New goods'
			then '100'
		else ''
	end as DEFAULTPROCUMENTWAREHOUSEID,
	case 
		when trim(ACNMVNDR) = 'New goods'
			then '10'
		else ''
	end as DEFAULTPURCHASESITEID,
	case 
		when trim(ACNMVNDR) = 'New goods'
			then 1
		else ''
	end as VENDORINVOICELINEMATCHINGPOLICY
,VNDCHKNM as TAX1099DOINGBUSINESSASNAME
,1 as TAX1099NAMETOUSE
,TXIDNMBR AS TAX1099FEDERALTAXID

,'' AS BANKACCOUNTID , vt.vendorId as YourAccountNumber 
,'--1-9999--' DEFAULTLEDGERDIMENSIONDISPLAYVALUE
, 
case
	when t.TEN99BOXTEXT = '1' then 'MISC-01'
	when t.TEN99BOXTEXT = '2' then 'MISC-02'
	when t.TEN99BOXTEXT = '3' then 'MISC-03'
	when t.TEN99BOXTEXT = '4' then 'MISC-04'
	when t.TEN99BOXTEXT = '5' then 'MISC-05'
	when t.TEN99BOXTEXT = '6' then 'MISC-06'
	when t.TEN99BOXTEXT = '7' then 'NEC-01'
	when t.TEN99BOXTEXT = '8' then 'MISC-08'
	when t.TEN99BOXTEXT = '10' then 'MISC-09'
	when t.TEN99BOXTEXT = '13' then 'MISC-13'
	when t.TEN99BOXTEXT = '14' then 'MISC-10'
	when t.TEN99BOXTEXT = '15a' then 'MISC-12'
	when t.TEN99BOXTEXT = '15b' then 'MISC-14'
	when t.TEN99BOXTEXT = '16' then 'MISC-15'
	when t.TEN99BOXTEXT = '18' then 'MISC-03'
else ''
end as TAX1099BOXID
,case 
	when t.TEN99BOXTEXT in ('1','2','3','4','5','6','8','10','13','14','15a','15b','16','18')
		then '1099-MISC'
	when t.TEN99BOXTEXT = '7'
		then '1099-NEC'
	else ''
end as  'Tax1099Type'
from blue.dbo.PM00200 vt
left join blue.[dbo].[PM40104] t
on t.TEN99BOXNUMBER = vt.TEN99BOXNUMBER
and t.TEN99TYPE = 3
where vt.vendstts = 1

union

select 
'EXCL' as DataAreaId,
Concat('Party-', 'EXCL-',VENDORID) as VendorPartyNumber,
		case 
	when len(dense_rank() over (order by vt.vendorid)) = 1
		then '1000000' + Cast((dense_rank() over (order by vt.vendorid)) as Nvarchar(10))
	when len(dense_rank() over (order by vt.vendorid)) = 2
		then '100000' + Cast((dense_rank() over (order by vt.vendorid)) as Nvarchar(10))
	when len(dense_rank() over (order by vt.vendorid)) = 3
		then '10000' + Cast((dense_rank() over (order by vt.vendorid)) as Nvarchar(10))
	when len(dense_rank() over (order by vt.vendorid)) = 4
		then '1000' + Cast((dense_rank() over (order by vt.vendorid)) as Nvarchar(10))
	when len(dense_rank() over (order by vt.vendorid)) = 5
		then '100' + Cast((dense_rank() over (order by vt.vendorid)) as Nvarchar(10))
	when len(dense_rank() over (order by vt.vendorid)) = 6
		then '10' + Cast((dense_rank() over (order by vt.vendorid)) as Nvarchar(10))
	when len(dense_rank() over (order by vt.vendorid)) = 7
		then '' + Cast((dense_rank() over (order by vt.vendorid)) as Nvarchar(10))
	end as vendoraccountnumber,
vendname as vendorsearchname,
vendname as vendororganizationname,
	ISNULL((case 
		when trim(ACNMVNDR) = 'New goods'
			then '100'
		when trim(ACNMVNDR) = 'Rent'
			then '200'
		when trim(ACNMVNDR) = 'Standard'
			then '300'
		when trim(ACNMVNDR) = 'Utility'
			then '400'
		when trim(ACNMVNDR) = 'Priority'
			then '500'
		when trim(ACNMVNDR) = 'Carrier'
			then '600'
		when trim(ACNMVNDR) = 'Software'
			then '700'
		when trim(ACNMVNDR) = 'Client Assist'
			then '800'
		when trim(ACNMVNDR) = 'CONTRACTOR'
			then '825'
		when trim(ACNMVNDR) = 'GCTA Instructor'
			then '850'
		when trim(ACNMVNDR) = 'Garnishments'
			then 900
		else '300'
	end),'') as VendorGroupID,

'USD' as CurrencyCode,
--PYMTRMID as DEFAULTPAYMENTTERMSNAME,
--case
--	when vt.COMMENT2 like 'du%'
--		then 'Due Upon Receipt'
--	when vt.comment2 like 'net%'
--		then 'Net 15'
--	else vt.COMMENT2
--end as DEFAULTPAYMENTTERMSNAME,
vt.comment2,
case when
	vt.COMMENT1 like 'manual%'
		then 'check'
	else vt.comment1
end as DEFAULTVENDORPAYMENTMETHODNAME,
hold as OnHoldStatus,
IsNULL(vt.ten99type,'') as TAX1099IDTYPE,
case
	when UserDef1 like '%1099%'
		then 'Yes'
	else 'No'
end as IsReportingTax1099,
'Yes' as IsW9Received,
CREDTLMT as CreditRating ,
	case 
		when trim(ACNMVNDR) = 'New goods'
			then '100'
		else ''
	end as DEFAULTPROCUMENTWAREHOUSEID,
	case 
		when trim(ACNMVNDR) = 'New goods'
			then '10'
		else ''
	end as DEFAULTPURCHASESITEID,
	case 
		when ACNMVNDR = 'New goods'
			then 1
		else ''
	end as VENDORINVOICELINEMATCHINGPOLICY
,VNDCHKNM as TAX1099DOINGBUSINESSASNAME
,1 as TAX1099NAMETOUSE
,TXIDNMBR AS TAX1099FEDERALTAXID

,'' AS BANKACCOUNTID , vt.vendorId as YourAccountNumber
,'--1-9999--' DEFAULTLEDGERDIMENSIONDISPLAYVALUE,
case
	when t.TEN99BOXTEXT = '1' then 'MISC-01'
	when t.TEN99BOXTEXT = '2' then 'MISC-02'
	when t.TEN99BOXTEXT = '3' then 'MISC-03'
	when t.TEN99BOXTEXT = '4' then 'MISC-04'
	when t.TEN99BOXTEXT = '5' then 'MISC-05'
	when t.TEN99BOXTEXT = '6' then 'MISC-06'
	when t.TEN99BOXTEXT = '7' then 'NEC-01'
	when t.TEN99BOXTEXT = '8' then 'MISC-08'
	when t.TEN99BOXTEXT = '10' then 'MISC-09'
	when t.TEN99BOXTEXT = '13' then 'MISC-13'
	when t.TEN99BOXTEXT = '14' then 'MISC-10'
	when t.TEN99BOXTEXT = '15a' then 'MISC-12'
	when t.TEN99BOXTEXT = '15b' then 'MISC-14'
	when t.TEN99BOXTEXT = '16' then 'MISC-15'
	when t.TEN99BOXTEXT = '18' then 'MISC-03'
else ''
end as TAX1099BOXID
,case 
	when t.TEN99BOXTEXT in ('1','2','3','4','5','6','8','10','13','14','15a','15b','16','18')
		then '1099-MISC'
	when t.TEN99BOXTEXT = '7'
		then '1099-NEC'
	else ''
end as  'Tax1099Type'
from excel.dbo.PM00200 vt
join excel.dbo.PM40104 t
on t.TEN99BOXNUMBER = vt.TEN99BOXNUMBER
and t.TEN99TYPE = 3
where vt.vendstts = 1


union

select 
'GTS' as DataAreaId,
Concat('Party-', 'GTS-',VENDORID) as VendorPartyNumber,
		case 
	when len(dense_rank() over (order by vt.vendorid)) = 1
		then '1000000' + Cast((dense_rank() over (order by vt.vendorid)) as Nvarchar(10))
	when len(dense_rank() over (order by vt.vendorid)) = 2
		then '100000' + Cast((dense_rank() over (order by vt.vendorid)) as Nvarchar(10))
	when len(dense_rank() over (order by vt.vendorid)) = 3
		then '10000' + Cast((dense_rank() over (order by vt.vendorid)) as Nvarchar(10))
	when len(dense_rank() over (order by vt.vendorid)) = 4
		then '1000' + Cast((dense_rank() over (order by vt.vendorid)) as Nvarchar(10))
	when len(dense_rank() over (order by vt.vendorid)) = 5
		then '100' + Cast((dense_rank() over (order by vt.vendorid)) as Nvarchar(10))
	when len(dense_rank() over (order by vt.vendorid)) = 6
		then '10' + Cast((dense_rank() over (order by vt.vendorid)) as Nvarchar(10))
	when len(dense_rank() over (order by vt.vendorid)) = 7
		then '' + Cast((dense_rank() over (order by vt.vendorid)) as Nvarchar(10))
	end as vendoraccountnumber,
vendname as vendorsearchname,
vendname as vendororganizationname,
--Concat(Address1,address2,address3) as AddressStreet
--,city as addresscity
--,state as addressstateid
--,case 
--	when country = 'Canada' or CCode = 'Canada'
--		then 'CAN'
--	else 'USA'
--end as addresscountryregionid, 
--case
--	when country = 'Canada' or CCode = 'Canada'
--		then 'CA'
--	else 'US' --addresscountryregionid
--end as ADDRESSCOUNTRYREGIONISOCODE,
--zipcode as addresszipcode,
--case
--	when PHNUMBR1 like '00%' 
--		then ''
--	else left(PHNUMBR1,10)
--end as PrimaryPhoneNumber,
--FAXNUMBR as PrimaryFaxNumber,
	--case 
	--	when ACNMVNDR = 'New goods'
	--		then '100'
	--	when VNDCLSID = 'Rent'
	--		then '200'
	--	when VNDCLSID = 'Tuition'
	--		then '300'
	--	when VNDCLSID = 'utilities'
	--		then '400'
	--	when VNDCLSID = 'Safe place voucher'
	--		then '500'
	--	when VNDCLSID = 'Trade accounts payable'
	--		then '600'
	--	else '700'
	--end as VendorGroupID,
	ISNULL((case 
		when trim(ACNMVNDR) = 'New goods'
			then '100'
		when trim(ACNMVNDR) = 'Rent'
			then '200'
		when trim(ACNMVNDR) = 'Standard'
			then '300'
		when trim(ACNMVNDR) = 'Utility'
			then '400'
		when trim(ACNMVNDR) = 'Priority'
			then '500'
		when trim(ACNMVNDR) = 'Carrier'
			then '600'
		when trim(ACNMVNDR) = 'Software'
			then '700'
		when trim(ACNMVNDR) = 'Client Assist'
			then '800'
		when trim(ACNMVNDR) = 'CONTRACTOR'
			then '825'
		when trim(ACNMVNDR) = 'GCTA Instructor'
			then '850'
		when trim(ACNMVNDR) = 'Garnishments'
			then 900
		else '300'
	end),'') as VendorGroupID,

'USD' as CurrencyCode,
vt.comment2,
case when
	vt.COMMENT1 like 'manual%'
		then 'check'
	else vt.comment1
end as DEFAULTVENDORPAYMENTMETHODNAME,
hold as OnHoldStatus,
IsNULL(vt.ten99type,'') as TAX1099IDTYPE,
case
	when UserDef1 like '%1099%'
		then 'Yes'
	else 'No'
end as IsReportingTax1099,
'Yes' as IsW9Received,
CREDTLMT as CreditRating,
	case 
		when trim(ACNMVNDR) = 'New goods'
			then '100'
		else ''
	end as DEFAULTPROCUMENTWAREHOUSEID,
	case 
		when trim(ACNMVNDR) = 'New goods'
			then '10'
		else ''
	end as DEFAULTPURCHASESITEID,
	case 
		when trim(ACNMVNDR) = 'New goods'
			then 1
		else ''
	end as VENDORINVOICELINEMATCHINGPOLICY
,VNDCHKNM as TAX1099DOINGBUSINESSASNAME
,1 as TAX1099NAMETOUSE
,TXIDNMBR AS TAX1099FEDERALTAXID

,'' AS BANKACCOUNTID , vt.vendorId as YourAccountNumber
,'--1-9999--'  DEFAULTLEDGERDIMENSIONDISPLAYVALUE,
case
	when t.TEN99BOXTEXT = '1' then 'MISC-01'
	when t.TEN99BOXTEXT = '2' then 'MISC-02'
	when t.TEN99BOXTEXT = '3' then 'MISC-03'
	when t.TEN99BOXTEXT = '4' then 'MISC-04'
	when t.TEN99BOXTEXT = '5' then 'MISC-05'
	when t.TEN99BOXTEXT = '6' then 'MISC-06'
	when t.TEN99BOXTEXT = '7' then 'NEC-01'
	when t.TEN99BOXTEXT = '8' then 'MISC-08'
	when t.TEN99BOXTEXT = '10' then 'MISC-09'
	when t.TEN99BOXTEXT = '13' then 'MISC-13'
	when t.TEN99BOXTEXT = '14' then 'MISC-10'
	when t.TEN99BOXTEXT = '15a' then 'MISC-12'
	when t.TEN99BOXTEXT = '15b' then 'MISC-14'
	when t.TEN99BOXTEXT = '16' then 'MISC-15'
	when t.TEN99BOXTEXT = '18' then 'MISC-03'
else ''
end as TAX1099BOXID
,case 
	when t.TEN99BOXTEXT in ('1','2','3','4','5','6','8','10','13','14','15a','15b','16','18')
		then '1099-MISC'
	when t.TEN99BOXTEXT = '7'
		then '1099-NEC'
	else ''
end as  'Tax1099Type'
from gss.dbo.PM00200 vt
left join gss.dbo.PM40104 t
on t.TEN99BOXNUMBER = vt.TEN99BOXNUMBER
and t.TEN99TYPE = 3
where vt.vendstts = 1


