USE [D365Migration]
GO
/****** Object:  StoredProcedure [dbo].[OpenARLines_GPToD365DB]    Script Date: 3/22/2022 9:16:44 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

ALTER Procedure [dbo].[OpenARLines_GPToD365DB]
as
INSERT INTO [dbo].[OpenARLines]
           ([DataAreaId]
           ,[JournalBatchNumber]
           ,[LineNumber]
           ,[DebitAmount]
           ,[InvoiceId]
           ,[DueDate]
           ,[CustomerAccountDisplayValue]
           ,[AccountType]
           ,[TermsOfPayment]
           ,[Currency]
           ,[OffsetAccountDisplayValue])
(
select 
'GICT',
(select  journalbatchnumber from openARHeaders where trim(substring(description, 19, len(description)-1)) = p.BACHNUMB) as JournalBatchNumber,
row_number() over ( partition by BACHNUMB order by bachnumb ) as LineNumber,
P.SLSAMNT as DebitTAMOUNT, --or debit?
p.DOCNUMBR as INVOICEID,
p.DUEDATE, 
--p. as voucher,
p.CUSTNMBR as Customeraccountdisplayvalue,
'Customer' as AccountType,
p.PYMTRMID as TermsOfPayment,
'USD' as Currency,
'12110' AS OFFSETACCOUNTDISPLAYVALUE

from GWC.dbo.RM20101 p
where p.RMDTYPAL = 1
)
