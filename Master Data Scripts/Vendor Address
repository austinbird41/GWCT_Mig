USE [D365Migration]
GO
/****** Object:  StoredProcedure [dbo].[VendorAddress_GPToD365DB]    Script Date: 5/26/2022 9:16:16 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
ALTER PROCEDURE [dbo].[VendorAddress_GPToD365DB]

AS


INSERT INTO [dbo].[VendorAddress]
           ([dataareaid]
		   ,AddressLocationId
           ,[VendorAccountNumber]
           ,[AddressStreet]
           ,[Addressdescription]
           ,[AddressCity]
           ,ADDRESSSTATEID
           ,[AddressZipCode]
           ,[AddressCountryRegionId]
           ,[VendorLegalEntityId])
select 
'GICT' as DataAreaId,
CONCAT('GICTVend-',CAST ( (ROW_NUMBER() OVER(ORDER BY p3.vendorId ASC)) AS NVARCHAR(50))) AS ADDRESSLOCATIONID,
--getdate() as AddressValidFrom, 
trim(p2.vendoraccountnumber) as VendorAccountNumber, --VendorAccountNumber
 replace(REPLACE ( REPLACE ( CONCAT(Trim(p3.address1), ' ',Trim(p3.address2), ' ', Trim(p3.address3)) , CHAR(13) , '' ) , CHAR(10) , ' ' ),char(9),'') AS AddressStreet,
p3.vendorid as AddressDescription,
 --p3.VNDCNTCT,
 p3.city as AddressCity,
 p3.state as AddressState,
 p3.zipcode as AddressZipCode,
case 
	when p3.country = 'Canada' or p3.CCode = 'Canada'
		then 'CAN'
	else 'USA'
end AddressCountryRegionId,
'GICT' as VendorLegalEntityId
 from gwc.dbo.PM00300 p3
join d365migration.dbo.vendors p2
on p2.ouraccountnumber = p3.vendorId
and dataareaid = 'gict'
where CONCAT(p3.address1,p3.address2,p3.address3) != ''

union

select 
'BLUE' as DataAreaId,
CONCAT('BLUEVend-',CAST ( (ROW_NUMBER() OVER(ORDER BY p3.vendorId ASC)) AS NVARCHAR(50))) AS ADDRESSLOCATIONID,
--getdate() as AddressValidFrom, 
trim(p2.vendoraccountnumber) as VendorAccountNumber, --VendorAccountNumber
 replace(REPLACE ( REPLACE ( CONCAT(Trim(p3.address1), ' ',Trim(p3.address2), ' ', Trim(p3.address3)) , CHAR(13) , '' ) , CHAR(10) , ' ' ),char(9),'') AS AddressStreet,
p3.vendorid as AddressDescription,
 --p3.VNDCNTCT,
 p3.city as AddressCity,
 p3.state as AddressState,
 p3.zipcode as AddressZipCode,
case 
	when p3.country = 'Canada' or p3.CCode = 'Canada'
		then 'CAN'
	else 'USA'
end AddressCountryRegionId,
'BLUE' as VendorLegalEntityId
 from blue.dbo.PM00300 p3
join d365migration.dbo.vendors p2
on p2.ouraccountnumber = p3.vendorId
and dataareaid = 'blue'
where CONCAT(p3.address1,p3.address2,p3.address3) != ''


union

select 
'EXCL' as DataAreaId,
CONCAT('EXCLVend-',CAST ( (ROW_NUMBER() OVER(ORDER BY p3.vendorId ASC)) AS NVARCHAR(50))) AS ADDRESSLOCATIONID,
--getdate() as AddressValidFrom, 
trim(p2.vendoraccountnumber) as VendorAccountNumber, --VendorAccountNumber
 replace(REPLACE ( REPLACE ( CONCAT(Trim(p3.address1), ' ',Trim(p3.address2), ' ', Trim(p3.address3)) , CHAR(13) , '' ) , CHAR(10) , ' ' ),char(9),'') AS AddressStreet,
p3.vendorid as AddressDescription,
 --p3.VNDCNTCT,
 p3.city as AddressCity,
 p3.state as AddressState,
 p3.zipcode as AddressZipCode,
case 
	when p3.country = 'Canada' or p3.CCode = 'Canada'
		then 'CAN'
	else 'USA'
end AddressCountryRegionId,
'EXCL' as VendorLegalEntityId
 from excel.dbo.PM00300 p3
join d365migration.dbo.vendors p2
on p2.ouraccountnumber = p3.vendorId
and dataareaid = 'excl'
where CONCAT(p3.address1,p3.address2,p3.address3) != ''


union

select 
'GTS' as dataareaid,
CONCAT('GTSVend-',CAST ( (ROW_NUMBER() OVER(ORDER BY p3.vendorId ASC)) AS NVARCHAR(50))) AS ADDRESSLOCATIONID,
--getdate() as AddressValidFrom, 
trim(p2.vendoraccountnumber) as VendorAccountNumber, --VendorAccountNumber
 replace(REPLACE ( REPLACE ( CONCAT(Trim(p3.address1), ' ',Trim(p3.address2), ' ', Trim(p3.address3)) , CHAR(13) , '' ) , CHAR(10) , ' ' ),char(9),'') AS AddressStreet,
p3.vendorid as Addressdescription,
 --p3.VNDCNTCT,
 p3.city as AddressCity,
 p3.state as AddressState,
 p3.zipcode as AddressZipCode,
case 
	when p3.country = 'Canada' or p3.CCode = 'Canada'
		then 'CAN'
	else 'USA'
end AddressCountryRegionId,
'GTS' as VendorLegalEntityId
 from gss.dbo.PM00300 p3
join d365migration.dbo.vendors p2
on p2.ouraccountnumber = p3.vendorId
and dataareaid = 'gts'
where CONCAT(p3.address1,p3.address2,p3.address3) != ''

