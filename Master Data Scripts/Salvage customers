USE [D365Migration]
GO
/****** Object:  StoredProcedure [dbo].[SalvageCustomers_GPToD365DB]    Script Date: 6/10/2022 2:31:38 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

ALTER Procedure [dbo].[SalvageCustomers_GPToD365DB]
as



INSERT INTO D365Migration.dbo.[SalvageCustomers]
           (Dataareaid 
		   ,PartyNumber
		   ,[CustomerAccount]
           ,[OrganizationName]
           ,[NameAlias]
           ,[CustomerGroupID]
           ,[AddressBooks]
		   ,[PrimaryContactEmail]
		   ,[PrimaryContactPhone]
		    ,[addressstreet]
           ,[AddressCountryRegionId]
           ,[AddressCity]
           ,[addressState]
           ,[AddressZipCode]
           ,[PaymentTerms]
           ,[salesCurrencyCode]
           ,[DiscountPriceGroupId]
           ,[onHoldstatus]
		   ,languageId
		   ,CredManCustomerSince
		   ,SalesAccountNumber
		   ,DefaultDimensionDisplayValue)



SELECT 'GICT' as DataAreaId,
	Concat('Party-','GICT-',full_name) as PartyNumber,
					case 
	when len(dense_rank() over (order by [full_name])) = 1
		then '2000000' + Cast((dense_rank() over (order by [full_name]))  as Nvarchar(10)) +200
	when len(dense_rank() over (order by [full_name])) = 2
		then '200000' + Cast((dense_rank() over (order by [full_name])) as Nvarchar(10)) +200
	when len(dense_rank() over (order by [full_name])) = 3
		then '20000' + Cast((dense_rank() over (order by [full_name])) as Nvarchar(10)) +200
	when len(dense_rank() over (order by [full_name])) = 4
		then '2000' + Cast((dense_rank() over (order by [full_name])) as Nvarchar(10)) +200
	when len(dense_rank() over (order by [full_name])) = 5
		then '200' + Cast((dense_rank() over (order by [full_name])) as Nvarchar(10)) +200
	when len(dense_rank() over (order by [full_name])) = 6
		then '20' + Cast((dense_rank() over (order by [full_name])) as Nvarchar(10)) +200
	when len(dense_rank() over (order by [full_name])) = 7
		then '2' + Cast((dense_rank() over (order by [full_name])) as Nvarchar(10)) +200
	end as customeraccount,
		full_name as OrganizationName
      ,full_name as NameAlias
	    ,'1011' as  CustomerGroupID 
	  ,'AllCust' as AddressBooks
	  ,e_mail as PRIMARYCONTACTEMAIL
	  ,
		case when phone != ''
			then concat(area_code, '-',phone) 
		else ''
		end as PrimaryContactPhone
       ,Concat(Address, ' ', Address2) as addressstreet
	  ,case
		when state IN ('ont','CAN')
			then 'CAN'
		when state in ('KR','PK')
			then 'PAK'
		else 'USA' 
	end as AddressCountryRegionId
      ,city as AddressCity
      , case
		when state IN ('ont','CAN')
			then 'on'
		when state in ('KR','PK')
			then 'PK-SD'
		else state
		end  as addressState
      ,zip as AddressZipCode
      ,'Net 30' as PaymentTerms
      ,'USD' as salesCurrencyCode
	  ,'AllStores' as DiscountPriceGroupId --Price Group, to default once configure
      ,0 as onHoldstatus
	 ,'en-us' as LanguageId
	  ,date_time as CredManCustomerSince
	  ,full_name as SalesAccountNumber
	  ,'-146000-1-9999--Proj999999'
from [posdatabase].SiriusSQL.dbo.accounts s
where acct_name like 'salvage%'

