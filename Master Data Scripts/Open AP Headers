USE [D365Migration]
GO
/****** Object:  StoredProcedure [dbo].[OpenAPHeaders_GPToD365DB]    Script Date: 6/7/2022 9:15:53 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

ALTER Procedure [dbo].[OpenAPHeaders_GPToD365DB]

as

INSERT INTO [dbo].[OpenAPHeaders]
           ([DataAreaId]
           ,[JournalBatchNumber]
           ,[JournalName]
           ,[Description])


(
select distinct
'GICT',
case 
	when len(dense_rank() over (order by p.bachnumb)) = 1
		then 'MIGP-00000' + Cast((dense_rank() over (order by p.bachnumb)) as Nvarchar(10))
	when len(dense_rank() over (order by p.bachnumb)) = 2
		then 'MIGP-0000' + Cast((dense_rank() over (order by p.bachnumb)) as Nvarchar(10))
	when len(dense_rank() over (order by p.bachnumb)) = 3
		then 'MIGP-000' + Cast((dense_rank() over (order by p.bachnumb)) as Nvarchar(10))
	when len(dense_rank() over (order by p.bachnumb)) = 4
		then 'MIGP-00' + Cast((dense_rank() over (order by p.bachnumb)) as Nvarchar(10))
	end as JournalBatchNumber,
'VEINV' as JournalName,
CONCAT('Open AP Migration- ', P.BACHNUMB) as Description

--bring them over with today's date, just try to use their voucher numbers, currency USD
from GWC.dbo.PM20000 p

union

select distinct
'GTS',
case 
	when len(dense_rank() over (order by p.bachnumb)) = 1
		then 'MIGP-00000' + Cast((dense_rank() over (order by p.bachnumb)) as Nvarchar(10))
	when len(dense_rank() over (order by p.bachnumb)) = 2
		then 'MIGP-0000' + Cast((dense_rank() over (order by p.bachnumb)) as Nvarchar(10))
	when len(dense_rank() over (order by p.bachnumb)) = 3
		then 'MIGP-000' + Cast((dense_rank() over (order by p.bachnumb)) as Nvarchar(10))
	when len(dense_rank() over (order by p.bachnumb)) = 4
		then 'MIGP-00' + Cast((dense_rank() over (order by p.bachnumb)) as Nvarchar(10))
	end as JournalBatchNumber,
'VEINV' as JournalName,
CONCAT('Open AP Migration- ', P.BACHNUMB) as Description

--bring them over with today's date, just try to use their voucher numbers, currency USD
from gss.dbo.PM20000 p

union
select distinct
'Blue',
case 
	when len(dense_rank() over (order by p.bachnumb)) = 1
		then 'MIGP-00000' + Cast((dense_rank() over (order by p.bachnumb)) as Nvarchar(10))
	when len(dense_rank() over (order by p.bachnumb)) = 2
		then 'MIGP-0000' + Cast((dense_rank() over (order by p.bachnumb)) as Nvarchar(10))
	when len(dense_rank() over (order by p.bachnumb)) = 3
		then 'MIGP-000' + Cast((dense_rank() over (order by p.bachnumb)) as Nvarchar(10))
	when len(dense_rank() over (order by p.bachnumb)) = 4
		then 'MIGP-00' + Cast((dense_rank() over (order by p.bachnumb)) as Nvarchar(10))
	end as JournalBatchNumber,
'VEINV' as JournalName,
CONCAT('Open AP Migration- ', P.BACHNUMB) as Description

--bring them over with today's date, just try to use their voucher numbers, currency USD
from blue.dbo.PM20000 p


union

select distinct
'Excl',
case 
	when len(dense_rank() over (order by p.bachnumb)) = 1
		then 'MIGP-00000' + Cast((dense_rank() over (order by p.bachnumb)) as Nvarchar(10))
	when len(dense_rank() over (order by p.bachnumb)) = 2
		then 'MIGP-0000' + Cast((dense_rank() over (order by p.bachnumb)) as Nvarchar(10))
	when len(dense_rank() over (order by p.bachnumb)) = 3
		then 'MIGP-000' + Cast((dense_rank() over (order by p.bachnumb)) as Nvarchar(10))
	when len(dense_rank() over (order by p.bachnumb)) = 4
		then 'MIGP-00' + Cast((dense_rank() over (order by p.bachnumb)) as Nvarchar(10))
	end as JournalBatchNumber,
'VEINV' as JournalName,
CONCAT('Open AP Migration- ', P.BACHNUMB) as Description

--bring them over with today's date, just try to use their voucher numbers, currency USD
from excel.dbo.PM20000 p

)

