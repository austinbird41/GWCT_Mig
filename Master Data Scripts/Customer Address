USE [D365Migration]
GO
/****** Object:  StoredProcedure [dbo].[CustomerAddress_GPToD365DB]    Script Date: 5/26/2022 9:30:24 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
ALTER PROCEDURE [dbo].[CustomerAddress_GPToD365DB]

AS



INSERT INTO [dbo].[CustomerAddress]
           (addresslocationid,
		   [dataareaid]
           ,[CustomerAccountNumber]
           ,[AddressStreet]
           ,[Addressdescription]
           ,[AddressCity]
           ,[AddressState]
           ,[AddressZipCode]
           ,[AddressCountryRegionId]
           ,[CustomerLegalEntityId])
select 
CONCAT('GICTCust-',CAST ( (ROW_NUMBER() OVER(ORDER BY r2.CUSTNMBR ASC)) AS NVARCHAR(50))) AS ADDRESSLOCATIONID,
'GICT' as DataAreaId,
(select customeraccount from D365Migration.dbo.Customers where SalesAccountNumber= trim(r2.CUSTNMBR) and dataareaid = 'gict') as CustomerAccountNumber, --CustomerAccountNumber
 replace(REPLACE ( REPLACE ( CONCAT(Trim(r2.address1), ' ',Trim(r2.address2), ' ', Trim(r2.address3)) , CHAR(13) , '' ) , CHAR(10) , ' ' ),char(9),'') AS AddressStreet,
r1.NameAlias as Addressdescription,
 --r2.VNDCNTCT,
 r2.city as AddressCity,
 r2.state as AddressState,
 r2.zip as AddressZipCode,
case 
	when r2.country = 'Canada' or r2.CCode = 'Canada'
		then 'CAN'
	else 'USA'
end AddressCountryRegionId,
'GICT' as CustomerLegalEntityId
 from gwc.dbo.RM00102 r2
join D365Migration.dbo.customers r1
on r1.salesaccountnumber = r2.CUSTNMBR
and r1.DataAreaId = 'gict'
where CONCAT(r2.address1,r2.address2,r2.address3) != ''

union

select 
CONCAT('BLUECust-',CAST ( (ROW_NUMBER() OVER(ORDER BY r2.CUSTNMBR ASC)) AS NVARCHAR(50))) AS ADDRESSLOCATIONID,
'BLUE' as DataAreaId,
(select customeraccount from D365Migration.dbo.Customers where SalesAccountNumber= trim(r2.CUSTNMBR) and dataareaid = 'blue') as CustomerAccountNumber, --CustomerAccountNumber
 replace(REPLACE ( REPLACE ( CONCAT(Trim(r2.address1), ' ',Trim(r2.address2), ' ', Trim(r2.address3)) , CHAR(13) , '' ) , CHAR(10) , ' ' ),char(9),'') AS AddressStreet,
r1.NameAlias as Addressdescription,
 --r2.VNDCNTCT,
 r2.city as AddressCity,
 r2.state as AddressState,
 r2.zip as AddressZipCode,
case 
	when r2.country = 'Canada' or r2.CCode = 'Canada'
		then 'CAN'
	else 'USA'
end AddressCountryRegionId,
'BLUE' as CustomerLegalEntityId
 from blue.dbo.RM00102 r2
join D365Migration.dbo.customers r1
on r1.salesaccountnumber = r2.CUSTNMBR
and r1.DataAreaId = 'blue'
where CONCAT(r2.address1,r2.address2,r2.address3) != ''


union

select 
CONCAT('EXCLCust-',CAST ( (ROW_NUMBER() OVER(ORDER BY r2.CUSTNMBR ASC)) AS NVARCHAR(50))) AS ADDRESSLOCATIONID,
'EXCL' as DataAreaId,
(select customeraccount from D365Migration.dbo.Customers where SalesAccountNumber= trim(r2.CUSTNMBR) and dataareaid = 'EXCL') as CustomerAccountNumber, --CustomerAccountNumber
 replace(REPLACE ( REPLACE ( CONCAT(Trim(r2.address1), ' ',Trim(r2.address2), ' ', Trim(r2.address3)) , CHAR(13) , '' ) , CHAR(10) , ' ' ),char(9),'') AS AddressStreet,
r1.NameAlias  as Addressdescription,
 --r2.VNDCNTCT,
 r2.city as AddressCity,
 r2.state as AddressState,
 r2.zip as AddressZipCode,
case 
	when r2.country = 'Canada' or r2.CCode = 'Canada'
		then 'CAN'
	else 'USA'
end AddressCountryRegionId,
'EXCL' as CustomerLegalEntityId
 from excel.dbo.RM00102 r2
join D365Migration.dbo.customers r1
on r1.salesaccountnumber = r2.CUSTNMBR
and r1.DataAreaId = 'excl'
where CONCAT(r2.address1,r2.address2,r2.address3) != ''


union

select 
CONCAT('GTSCust-',CAST ( (ROW_NUMBER() OVER(ORDER BY r2.CUSTNMBR ASC)) AS NVARCHAR(50))) AS ADDRESSLOCATIONID,
'GTS' as dataareaid,
(select customeraccount from D365Migration.dbo.Customers where SalesAccountNumber= trim(r2.CUSTNMBR) and dataareaid = 'GTS') as CustomerAccountNumber, --CustomerAccountNumber
 replace(REPLACE ( REPLACE ( CONCAT(Trim(r2.address1), ' ',Trim(r2.address2), ' ', Trim(r2.address3)) , CHAR(13) , '' ) , CHAR(10) , ' ' ),char(9),'') AS AddressStreet,
r1.NameAlias as Addressdescription,
 --r2.VNDCNTCT,
 r2.city as AddressCity,
 r2.state as AddressState,
 r2.zip as AddressZipCode,
case 
	when r2.country = 'Canada' or r2.CCode = 'Canada'
		then 'CAN'
	else 'USA'
end AddressCountryRegionId,
'GTS' as CustomerLegalEntityId
 from gss.dbo.RM00102 r2
join D365Migration.dbo.customers r1
on r1.salesaccountnumber = r2.CUSTNMBR
and r1.DataAreaId = 'gts'
where CONCAT(r2.address1,r2.address2,r2.address3) != ''

