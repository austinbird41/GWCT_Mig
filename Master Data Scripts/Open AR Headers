USE [D365Migration]
GO
/****** Object:  StoredProcedure [dbo].[OpenARHeaders_GPToD365DB]    Script Date: 6/7/2022 9:12:37 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

ALTER Procedure [dbo].[OpenARHeaders_GPToD365DB]

as

INSERT INTO [dbo].[OpenARHeaders]
           ([DataAreaId]
           ,[JournalBatchNumber]
           ,[JournalName]
           ,[Description])


(
select distinct
'GICT',
case 
	when len(dense_rank() over (order by p.bachnumb) + 100) = 3
		then 'MIGR-000' + Cast((dense_rank() over (order by p.bachnumb) + 100) as Nvarchar(10))
	when len(dense_rank() over (order by p.bachnumb) + 100) = 4
		then 'MIGR-00' + Cast((dense_rank() over (order by p.bachnumb) + 100) as Nvarchar(10))
	when len(dense_rank() over (order by p.bachnumb) + 100) = 5
		then 'MIGR-0' + Cast((dense_rank() over (order by p.bachnumb) + 100) as Nvarchar(10))
	when len(dense_rank() over (order by p.bachnumb) + 100) = 6
		then 'MIGR-' + Cast((dense_rank() over (order by p.bachnumb) + 100) as Nvarchar(10))
	end as JournalBatchNumber,
'CUSINV' as JournalName,
CONCAT('Open AR Migration- ', P.BACHNUMB) as Description
--bring them over with today's date, just try to use their voucher numbers, currency USD
from gwc.dbo.RM20101 p


union
select distinct
'Blue',
case 
	when len(dense_rank() over (order by p.bachnumb) + 100) = 3
		then 'MIGR-000' + Cast((dense_rank() over (order by p.bachnumb) + 100) as Nvarchar(10))
	when len(dense_rank() over (order by p.bachnumb) + 100) = 4
		then 'MIGR-00' + Cast((dense_rank() over (order by p.bachnumb) + 100) as Nvarchar(10))
	when len(dense_rank() over (order by p.bachnumb) + 100) = 5
		then 'MIGR-0' + Cast((dense_rank() over (order by p.bachnumb) + 100) as Nvarchar(10))
	when len(dense_rank() over (order by p.bachnumb) + 100) = 6
		then 'MIGR-' + Cast((dense_rank() over (order by p.bachnumb) + 100) as Nvarchar(10))
	end as JournalBatchNumber,
'CUSINV' as JournalName,
CONCAT('Open AR Migration- ', P.BACHNUMB) as Description
--bring them over with today's date, just try to use their voucher numbers, currency USD
from blue.dbo.RM20101 p


union

select distinct
'GTS',
case 
	when len(dense_rank() over (order by p.bachnumb) + 100) = 3
		then 'MIGR-000' + Cast((dense_rank() over (order by p.bachnumb) + 100) as Nvarchar(10))
	when len(dense_rank() over (order by p.bachnumb) + 100) = 4
		then 'MIGR-00' + Cast((dense_rank() over (order by p.bachnumb) + 100) as Nvarchar(10))
	when len(dense_rank() over (order by p.bachnumb) + 100) = 5
		then 'MIGR-0' + Cast((dense_rank() over (order by p.bachnumb) + 100) as Nvarchar(10))
	when len(dense_rank() over (order by p.bachnumb) + 100) = 6
		then 'MIGR-' + Cast((dense_rank() over (order by p.bachnumb) + 100) as Nvarchar(10))
	end as JournalBatchNumber,
'CUSINV' as JournalName,
CONCAT('Open AR Migration- ', P.BACHNUMB) as Description
--bring them over with today's date, just try to use their voucher numbers, currency USD
from gss.dbo.RM20101 p

)

